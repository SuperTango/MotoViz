<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Demo</title>
 <style>
    a.test { font-weight: bold; }
 </style>

<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="http://maps.googleapis.com/maps/api/js?sensor=false">
</script>

    <!-- 1. Add these JavaScript inclusions in the head of your page -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript" src="Highcharts-2.1.6/js/highcharts.js"></script>
    
    <!-- 1a) Optional: add a theme file -->
    <script type="text/javascript" src="Highcharts-2.1.6/js/themes/grid.js"></script>
    
    <!-- 1b) Optional: the exporting module -->
    <script type="text/javascript" src="Highcharts-2.1.6//js/modules/exporting.js"></script>
    <script type="text/javascript">
var chart;
$(document).ready(function() {
    var ride_info;
    $.ajax({ url: 'http://motoviz.funkware.com/v1/rides/uid_E0740DAE-D361-11E0-B80A-910AC869DD8D/rid_45ECB7CC-D433-11E0-BD6D-C4EC9AAFEDAC', 
             dataType: 'json',
             async: false,
             success: function(data) {
                 ride_info = data;
            }});


    $.getJSON('http://motoviz.funkware.com/v1/points/uid_E0740DAE-D361-11E0-B80A-910AC869DD8D/rid_45ECB7CC-D433-11E0-BD6D-C4EC9AAFEDAC?limit_points=150', function(data) {
      //alert('Load was performed.');
    
    var rideCoords = new Array();
    var numPoints = data.lat.length;
    var coordsHash = {};
    var myOptions = {
        zoom: 1,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

    for ( var i = 0; i < numPoints; i++ ) {
        var coord = new google.maps.LatLng ( data.lat[i][1], data.lon[i][1] );
        rideCoords.push ( coord );
        var s = "X" + data.lat[i][0];
        coordsHash[s] = coord;
    }
    var abc = new Array ( new google.maps.LatLng ( 39.8880416666667, -83.269916666666 ) );
    var rideLine2 = new google.maps.Polyline ( {
        path: abc,
        strokeColor: "#FFFF00",
        strokeOpacity: 1.0,
        strokeWeight: 3
    } );

    var rideLine = new google.maps.Polyline ( {
        path: rideCoords,
        strokeColor: "#FF0000",
        strokeOpacity: 1.0,
        strokeWeight: 2
    } );
    var startMarker = new google.maps.Marker ( {
        position: new google.maps.LatLng ( data.lat[0][1], data.lon[0][1] ),
        animation: google.maps.Animation.DROP,
        title: "Start",
        icon: "http://motoviz.funkware.com/images/motorcycle.png",

    });
    var endMarker = new google.maps.Marker ( {
        position: new google.maps.LatLng ( data.lat[numPoints - 1][1], data.lon[numPoints - 1][1] ),
        animation: google.maps.Animation.DROP,
        title: "End",
        icon: "http://motoviz.funkware.com/images/parking.png",
    });
    var pointMarker = new google.maps.Marker( {
        map: map,
        visible: false } );

    chart = new Highcharts.Chart({
      chart: {
         renderTo: 'chart_container',
         zoomType: 'x',
         //spacingRight: 20,
         defaultSeriesType: 'spline',
         events : {
             mouseMove: function() {
                 alert ( 'mouse move' );
             }
         }
      },
       title: {
         text: 'Kyle Data'
      },
       subtitle: {
         text: document.ontouchstart === undefined ?
            'Click and drag in the plot area to zoom in' :
            'Drag your finger over the plot to zoom in'
      },
      xAxis: {
         type: 'datetime',
         maxZoom: 30,
         title: {
            text: null
         }
      },
      yAxis: {
         title: {
            text: 'Exchange rate'
         },
         startOnTick: false,
         showFirstLabel: false,
         plotLines: [{
            value: 0,
            width: 1,
            color: '#808080'
         }]

      },
      tooltip: {
          shared: true,
          formatter: function() {
              var dateObj = new Date( this.x );

              var s = '<b>'+ dateObj.toString() +'</b>';
             
              $.each(this.points, function(i, point) {
                  s += '<br/>'+ point.series.name +': '+ point.y +'m';
              });
              var index = "X" + this.x;
              pointMarker.setPosition ( coordsHash[index] );
              pointMarker.setVisible ( true );
              return s;
          },
          shared: true,
          crosshairs: true,
      },
      legend: {
         enabled: true
      },
      plotOptions: {
          series: {
              /*
              events: {
                  mouseOver: function() {
                          var s = "";
                          for ( var field in this ) {
                              s += ", " + field;
                          }

                      alert ( "series mouseover: " + s );
                  }
              },
              */
              point: {
                  events: {
                      mouseOver: function() {
                          //alert ( "point mouseover" );
                          //alert ( coordsHash[s] );
                          //var p1 = google.maps.Circle ();
                          //p1.setCenter ( coordsHash[s] );
                          //p1.setMap ( map );
                          //var s = "X" + this.x;
                          //pointMarker.setPosition ( coordsHash[s] );
                          //pointMarker.setVisible ( true );
                      },
                      click: function() {
                          //var s = "X" + this.x;
                          //alert ( coordsHash[s] );
                          //var p1 = google.maps.Circle ();
                          //p1.setMap ( map );
                          //p1.setCenter ( coordsHash[s] );
                              //new google.maps.LatLng ( 39.97151333, -83.12428333 )
                              //fillColor: "#00FF00",
                              //fillOpacity: 0.5,
                              //radius: 5,
                              //map: map ,
                              //);
                      }
                  },
              }
              /*
              point: {
                  events: {
                      click: function() {
                          alert ( this.x + ", " + this.y );
                          this.select(this.selected ? false : true, true)
                      }
                  }
              }*/
          },

         spline: {
            marker: {
               radius: 2,
               lineColor: '#666666',
               lineWidth: 1
            }
         },

         area: {
            fillColor: {
               linearGradient: [0, 0, 0, 300],
               stops: [
                  [0, Highcharts.getOptions().colors[0]],
                  [1, 'rgba(2,0,0,0)']
               ]
            },
            lineWidth: 1,
            marker: {
               enabled: false,
               states: {
                  hover: {
                     enabled: true,
                     radius: 5
                  }
               }
            },
            shadow: false,
            states: {
               hover: {
                  lineWidth: 1                  
               }
            }
         }
      },
   
      series: [
        {
         type: 'line',
         name: 'Volts',
         data: data.battery_volts,
        },
        {
         type: 'spline',
         name: 'Amps',
         data: data.battery_amps,
        },
        {
         type: 'line',
         name: 'Speed (GPS)',
         data: data.speed_gps,
        },
        ]
    });

            /*
             * google maps
             */
        var latlng = new google.maps.LatLng(-34.397, 150.644);
        //alert ( ride_info.lat_min );
        map.fitBounds ( new google.maps.LatLngBounds ( new google.maps.LatLng ( ride_info.lat_min, ride_info.lon_min ), new google.maps.LatLng ( ride_info.lat_max, ride_info.lon_max ) ) );
        rideLine.setMap ( map );
        startMarker.setMap ( map );
        endMarker.setMap ( map );
        //var p2 = new google.maps.Circle();
        //p2.setRadius ( 10 );
        //p2.setCenter ( new google.maps.LatLng ( 39.97151333, -83.12428333 ) );
        //p2.setMap ( map );
        
    });
   
});
    </script>
 
  </head>
  <body>
		<!-- 3. Add the container -->
		<div id="chart_container" style="width: 100%; height: 50%; margin: 0 auto"></div>
                <div id="map_canvas" style="width:100%; height:50%"></div>


		
  </body>
</html>

